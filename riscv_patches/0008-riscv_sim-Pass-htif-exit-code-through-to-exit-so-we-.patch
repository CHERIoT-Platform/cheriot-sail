From 4be78b16b219dbed06649feaf494ae115580fa7a Mon Sep 17 00:00:00 2001
From: Robert Norton <ronorton@microsoft.com>
Date: Thu, 26 Jan 2023 13:56:21 +0000
Subject: [PATCH 8/9] riscv_sim: Pass htif exit code through to exit so we can
 easily test it when running tests.

---
 c_emulator/riscv_sim.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/c_emulator/riscv_sim.c b/c_emulator/riscv_sim.c
index 55d04ce..cdb1868 100644
--- a/c_emulator/riscv_sim.c
+++ b/c_emulator/riscv_sim.c
@@ -1034,7 +1034,7 @@ dump_state:
   if (diverged) {
     /* TODO */
   }
-  finish(diverged);
+  finish(diverged | zhtif_exit_code);
 
 step_exception:
   fprintf(stderr, "Sail exception!");
-- 
2.39.2

