From 93f474ef62752f9695fc65ff8c1d3da2ae25c8de Mon Sep 17 00:00:00 2001
From: Robert Norton <ronorton@microsoft.com>
Date: Thu, 26 Jan 2023 13:56:21 +0000
Subject: [PATCH 08/10] riscv_sim: Pass htif exit code through to exit so we
 can easily test it when running tests.

---
 c_emulator/riscv_sim.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/c_emulator/riscv_sim.c b/c_emulator/riscv_sim.c
index 8fde33f..4bcff94 100644
--- a/c_emulator/riscv_sim.c
+++ b/c_emulator/riscv_sim.c
@@ -964,7 +964,7 @@ void run_sail(void)
   if (diverged) {
     /* TODO */
   }
-  finish(diverged);
+  finish(diverged | zhtif_exit_code);
 
  step_exception:
   fprintf(stderr, "Sail exception!");
-- 
2.39.2

